<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Laptop Listings Viewer</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      padding: 20px;
      font-family: Arial, sans-serif;
    }
    .listing-card {
      margin-bottom: 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      transition: transform 0.2s;
    }
    .listing-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    .badge {
      margin-right: 5px;
    }
    .true-badge {
      background-color: #28a745;
    }
    .false-badge {
      background-color: #dc3545;
    }
    .unknown-badge {
      background-color: #6c757d;
    }
    .filter-section {
      background-color: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .sort-button {
      margin-right: 10px;
      margin-bottom: 10px;
    }
    .price {
      font-weight: bold;
      color: #dc3545;
    }
    .loading {
      text-align: center;
      padding: 50px;
      font-size: 24px;
      color: #6c757d;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="mb-4">Laptop Listings Viewer</h1>
    
    <div class="filter-section">
      <h4>Sort and Filter</h4>
      <div class="mb-3">
        <button id="sort-price-asc" class="btn btn-outline-primary sort-button">Price (Low to High)</button>
        <button id="sort-price-desc" class="btn btn-outline-primary sort-button">Price (High to Low)</button>
        <button id="sort-full-info" class="btn btn-outline-primary sort-button">Full Info Available</button>
        <button id="reset-sort" class="btn btn-outline-secondary sort-button">Reset Sort</button>
      </div>
      
      <div class="row">
        <div class="col-md-3">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="filter-ram-more">
            <label class="form-check-label" for="filter-ram-more">RAM > 16GB</label>
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="filter-screen-small">
            <label class="form-check-label" for="filter-screen-small">Small Screen</label>
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="filter-screen-highres">
            <label class="form-check-label" for="filter-screen-highres">High Resolution</label>
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="filter-full-info">
            <label class="form-check-label" for="filter-full-info">Full Info Available</label>
          </div>
        </div>
      </div>
    </div>
    
    <div id="listings-count" class="alert alert-info">Loading listings...</div>
    
    <div id="loading" class="loading">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p>Loading listings...</p>
    </div>
    
    <div id="listings-container" class="row"></div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      let allListings = [];
      let filteredListings = [];
      
      // DOM elements
      const listingsContainer = document.getElementById('listings-container');
      const listingsCount = document.getElementById('listings-count');
      const loadingElement = document.getElementById('loading');
      
      // Sort buttons
      const sortPriceAsc = document.getElementById('sort-price-asc');
      const sortPriceDesc = document.getElementById('sort-price-desc');
      const sortFullInfo = document.getElementById('sort-full-info');
      const resetSort = document.getElementById('reset-sort');
      
      // Filter checkboxes
      const filterRamMore = document.getElementById('filter-ram-more');
      const filterScreenSmall = document.getElementById('filter-screen-small');
      const filterScreenHighres = document.getElementById('filter-screen-highres');
      const filterFullInfo = document.getElementById('filter-full-info');
      
      // Add these event listeners for immediate filtering
      filterRamMore.addEventListener('change', applyFiltersImmediately);
      filterScreenSmall.addEventListener('change', applyFiltersImmediately);
      filterScreenHighres.addEventListener('change', applyFiltersImmediately);
      filterFullInfo.addEventListener('change', applyFiltersImmediately);
      
      // Fetch listings data
      fetch('/api/listings')
        .then(response => response.json())
        .then(data => {
          allListings = data;
          filteredListings = [...allListings];
          loadingElement.style.display = 'none';
          updateListingsCount();
          renderListings(filteredListings);
        })
        .catch(error => {
          console.error('Error fetching listings:', error);
          loadingElement.innerHTML = '<p class="text-danger">Error loading listings. Please try again later.</p>';
        });
      
      // Sort event listeners
      sortPriceAsc.addEventListener('click', () => {
        filteredListings.sort((a, b) => {
          const priceA = parsePrice(a.price);
          const priceB = parsePrice(b.price);
          return priceA - priceB;
        });
        renderListings(filteredListings);
      });
      
      sortPriceDesc.addEventListener('click', () => {
        filteredListings.sort((a, b) => {
          const priceA = parsePrice(a.price);
          const priceB = parsePrice(b.price);
          return priceB - priceA;
        });
        renderListings(filteredListings);
      });
      
      sortFullInfo.addEventListener('click', () => {
        filteredListings.sort((a, b) => {
          if (a.full_info_obtained === true && b.full_info_obtained !== true) return -1;
          if (a.full_info_obtained !== true && b.full_info_obtained === true) return 1;
          return 0;
        });
        renderListings(filteredListings);
      });
      
      resetSort.addEventListener('click', () => {
        filteredListings = [...allListings];
        applyCurrentFilters();
        renderListings(filteredListings);
      });
      
      // Add this function for immediate filtering
      function applyFiltersImmediately() {
        applyCurrentFilters();
        renderListings(filteredListings);
      }
      
      // Helper functions
      function parsePrice(priceString) {
        if (!priceString) return 0;
        // Extract numbers from the price string (e.g., "â‚¬ 1.200" -> 1200)
        const match = priceString.match(/[\d.,]+/);
        if (!match) return 0;
        
        // Replace comma with dot for decimal and remove thousands separators
        return parseFloat(match[0].replace(/\./g, '').replace(',', '.'));
      }
      
      function applyCurrentFilters() {
        filteredListings = allListings.filter(listing => {
          let include = true;
          
          if (filterRamMore.checked) {
            include = include && listing.RAM_more === true;
          }
          
          if (filterScreenSmall.checked) {
            include = include && listing.screen_small === true;
          }
          
          if (filterScreenHighres.checked) {
            include = include && listing.screen_highres === true;
          }
          
          if (filterFullInfo.checked) {
            include = include && listing.full_info_obtained === true;
          }
          
          return include;
        });
        
        updateListingsCount();
      }
      
      function updateListingsCount() {
        listingsCount.textContent = `Showing ${filteredListings.length} of ${allListings.length} listings`;
      }
      
      function getBadgeClass(value) {
        if (value === true) return 'true-badge';
        if (value === false) return 'false-badge';
        return 'unknown-badge';
      }
      
      function renderListings(listings) {
        listingsContainer.innerHTML = '';
        
        listings.forEach(listing => {
          const card = document.createElement('div');
          card.className = 'col-md-6 col-lg-4';
          
          const ramBadgeClass = getBadgeClass(listing.RAM_more);
          const screenSmallBadgeClass = getBadgeClass(listing.screen_small);
          const screenHighresBadgeClass = getBadgeClass(listing.screen_highres);
          const fullInfoBadgeClass = getBadgeClass(listing.full_info_obtained);
          
          card.innerHTML = `
            <div class="listing-card">
              <h5 class="card-title">${listing.title}</h5>
              <p class="price">${listing.price || 'Price not available'}</p>
              <p class="location">${listing.location || ''}</p>
              
              <div class="badges mb-2">
                <span class="badge ${ramBadgeClass}">RAM > 16GB: ${listing.RAM_more}</span>
                <span class="badge ${screenSmallBadgeClass}">Small Screen: ${listing.screen_small}</span>
                <span class="badge ${screenHighresBadgeClass}">High Res: ${listing.screen_highres}</span>
                <span class="badge ${fullInfoBadgeClass}">Full Info: ${listing.full_info_obtained}</span>
              </div>
              
              <p class="description">${listing.short_description || ''}</p>
              
              <div class="mt-3">
                <a href="${listing.url}" target="_blank" class="btn btn-primary">View Listing</a>
              </div>
            </div>
          `;
          
          listingsContainer.appendChild(card);
        });
      }
    });
  </script>
</body>
</html> 